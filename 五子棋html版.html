<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>五子棋</title>
    <script src="http://lib.sinaapp.com/js/jquery/3.1.0/jquery-3.1.0.min.js"></script>
    <style  type="text/css">
    td{
        border: 1px solid black;
        height: 50px;
        width: 50px;
        padding: 0px;
        margin: 0px;
        background: darkgoldenrod;
    }
        .black{
            border: 1px solid black;
            border-radius: 50%;
            background: black;
            height: 40px;
            width: 40px;
            margin: auto;
        }
        .white{
            border: 1px solid black;
            border-radius: 50%;
            background: white;
            height: 40px;
            width: 40px;
            margin: auto;
        }
    </style>
</head>
<body>
<center>
    <div>
    <button onclick="Repeat()">重置</button><button onclick="Regret()">悔棋</button><button onclick="Cancel()">撤销悔棋</button>
    </div>
    <table border='0' cellpadding='0' cellspacing='0'>
    </table>
</center>
</body>
</html>
<script type="text/javascript">
var height_number=10  //棋盘的高度
var width_numebr=10   //棋盘的宽度
var changelist=['black','white']
var change=0
var regret_info=['','']
var change_regret=0
HeightAndWidth()
var tds = $("td");
function HeightAndWidth()  //创建棋盘
{
    height_number=10
    width_numebr=10
    change=0
    for(let i=0;i<height_number;i++)
    {
        $('table').append("<tr></tr>")
        for(let j=0;j<width_numebr;j++)
        {
            $('table tr').eq(i).append("<td><div></div></td>")
            $('table tr').eq(i).children("td").eq(j).children("div").attr({row:i,col:j})
        }
        // $('table tr td').eq(i).children("div").addClass("black")
    }
    tds = $("td");
}
function Regret()//悔棋
{
    change_regret=1
    $("td").eq(parseInt(regret_info[0])*height_number+parseInt(regret_info[1])).children("div").removeClass("black white")
    change=Math.abs(change-1)
}
function Cancel() {
    if(change_regret){
        $("td").eq(parseInt(regret_info[0])*height_number+parseInt(regret_info[1])).children("div").addClass(changelist[change])
        change=Math.abs(change-1)
        change_regret=0
    }

}
function Repeat(){
    $("td").remove();
    HeightAndWidth();
    $("td").on("click",function () {
        if($(this).children("div").css("background").indexOf('rgba(0, 0, 0, 0)')>=0)
        {
            $(this).children("div").addClass(changelist[change])
            change=Math.abs(change-1)
            regret_info=[$(this).children("div").attr("row"),$(this).children("div").attr("col")]
            CheckWin($(this).children("div").attr("row"),$(this).children("div").attr("col"),$(this).children("div").css("background"))
        }})
}    //重置
function CheckWin(row,col,color){
    var curr = {
         x: col,y: row,color: color};
    var line = ['', '', '', ''];
      for (let i = 0, tmp = {}; i < height_number*width_numebr; i++) {
                 tmp = {
                          x: tds.eq(i).children("div").attr("col"),
                          y: tds.eq(i).children("div").attr("row"),
                         color: '0'
                 };
                 if (tds.eq(i).children("div").css("background").indexOf('rgb(0, 0, 0)') >= 0) {
                        tmp.color = 'b';
                      } else if (tds.eq(i).children("div").css("background").indexOf('rgb(255, 255, 255)') >= 0) {
                         tmp.color = 'w';
                       }
                 if (curr.y == tmp.y) {
                   line[0] += tmp.color;

                  }
                 if (curr.x == tmp.x) {

                       line[1] += tmp.color;
                    }
                if ((parseInt(curr.x) + parseInt(curr.y)) == (parseInt(tmp.x) + parseInt(tmp.y))) {
                         line[2] += tmp.color;
                     }
                if ((curr.x - tmp.x) == (curr.y - tmp.y)) {

                     line[3] += tmp.color;
              }
         }
       color = color.indexOf('rgb(0, 0, 0)')>=0 ? 'bbbbb' : 'wwwww'; //赢家的颜色
       let wincolor=color=='bbbbb'?'黑方胜利':'白方胜利'
       for (var i = 0; i < 4; i++) {
              if (line[i].indexOf(color) >= 0) {
                    alert(wincolor);
                    Repeat()
                    break
                }
           }
}   //判断胜利
$("td").on("click",function () {
    if($(this).children("div").css("background").indexOf('rgba(0, 0, 0, 0)')>=0)
    {
        $(this).children("div").addClass(changelist[change])
        change=Math.abs(change-1)
        regret_info=[$(this).children("div").attr("row"),$(this).children("div").attr("col")]
        CheckWin($(this).children("div").attr("row"),$(this).children("div").attr("col"),$(this).children("div").css("background"))
    }
   })

</script>
